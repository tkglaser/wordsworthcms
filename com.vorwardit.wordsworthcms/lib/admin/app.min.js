!function(){"use strict";angular.module("app",["ngAnimate","ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"lib/admin/Views/Welcome.html",controller:"WelcomeController"}).when("/sites",{templateUrl:"lib/admin/Views/Sites.html",controller:"SiteController as ctrl"}).when("/layouts",{templateUrl:"lib/admin/Views/Layouts.html",controller:"LayoutController as ctrl"}).when("/pagelayouts",{templateUrl:"lib/admin/Views/PageLayouts.html",controller:"PageLayoutController as ctrl"}).when("/pages",{templateUrl:"lib/admin/Views/Pages.html",controller:"PageController as ctrl"}).when("/assets",{templateUrl:"lib/admin/Views/Assets.html",controller:"AssetController as ctrl"}).when("/content",{templateUrl:"lib/admin/Views/Content.html",controller:"ContentController as ctrl"}).when("/users",{templateUrl:"lib/admin/Views/Users.html",controller:"UserController as ctrl"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";function e(e,t,n){function i(){n.getData().success(function(e){o.sites=e,o.site=n.getSelectedSite(e),t.getData(o.site.siteId).success(function(e){o.assets=e})})}var o=this;o.title="AssetController",o.assets=[],o.asset={},o.sites=[],o.site={},i(),o.siteChanged=function(){n.setSelectedSite(o.site),t.getData(o.site.siteId).success(function(e){o.assets=e})},o.create=function(){$("#saveError").hide(),$("#editModal").modal()},o["delete"]=function(e){$("#deleteError").hide(),o.asset=e,$("#deleteModal").modal()},o.deleteConfirmed=function(){t.remove(o.site.siteId,o.asset.name).then(function(){$("#deleteModal").modal("hide"),i()},function(){$("#deleteError").show()})},o.save=function(){o.asset.siteId=o.site.siteId,t.upload(o.asset).then(function(){$("#editModal").modal("hide"),i()},function(){$("#saveError").show()})}}angular.module("app").controller("AssetController",e),e.$inject=["$location","AssetFactory","SiteFactory"]}(),function(){"use strict";function e(e,t,n){function i(){n.getData().success(function(e){o.sites=e,o.site=n.getSelectedSite(e),t.getBySiteId(o.site.siteId).success(function(e){o.contents=e})})}var o=this;o.title="ContentController",o.modalHeadingNew="Neuen Content anlegen",o.modalHeadingEdit="Content bearbeiten",o.modalHeading=o.modalHeadingEdit,o.contents=[],o.content={},o.sites=[],o.site={},i(),o.siteChanged=function(){n.setSelectedSite(o.site),t.getBySiteId(o.site.siteId).success(function(e){o.contents=e})},o.create=function(){$("#saveError").hide(),o.modalHeading=o.modalHeadingNew,o.content={},o.content.contentId=-1,o.content.url="",o.content.body="",$("#editModal").modal()},o.edit=function(e){t.getData(e.contentId).success(function(e){$("#saveError").hide(),o.modalHeading=o.modalHeadingEdit,o.content=e,$("#editModal").modal()})},o["delete"]=function(e){$("#deleteError").hide(),o.content=e,$("#deleteModal").modal()},o.deleteConfirmed=function(){t.remove(o.content.contentId).then(function(){$("#deleteModal").modal("hide"),i()},function(){$("#deleteError").show()})},o.save=function(){var e={ContentId:o.content.contentId,SiteId:o.site.siteId,Url:o.content.url,Body:o.content.body};t.update(e).then(function(){$("#editModal").modal("hide"),i()},function(){$("#saveError").show()})}}angular.module("app").controller("ContentController",e),e.$inject=["$location","ContentFactory","SiteFactory"]}(),function(){"use strict";function e(e,t,n){function i(){n.getData().success(function(e){o.sites=e,o.site=n.getSelectedSite(e),t.getBySiteId(o.site.siteId).success(function(e){o.layouts=e})})}var o=this;o.title="LayoutController",o.modalHeadingNew="Neues Layout anlegen",o.modalHeadingEdit="Layout bearbeiten",o.modalHeading=o.modalHeadingEdit,o.layouts=[],o.layout={},o.sites=[],o.site={},i();var a={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]};o.editor=CodeMirror.fromTextArea(document.getElementById("htmlEditorLayouts"),{mode:a,selectionPointer:!0,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}}),o.siteChanged=function(){n.setSelectedSite(o.site),t.getBySiteId(o.site.siteId).success(function(e){o.layouts=e})},o.create=function(){$("#saveError").hide(),o.modalHeading=o.modalHeadingNew,o.layout={},o.layout.name="",o.layout.body="",o.editor.setValue(""),setTimeout(function(){o.editor.refresh()},200),$("#editModal").modal()},o.edit=function(e){t.getData(e.layoutId).success(function(e){$("#saveError").hide(),o.modalHeading=o.modalHeadingEdit,o.layout=e,o.editor.setValue(o.layout.body),setTimeout(function(){o.editor.refresh()},200),$("#editModal").modal()})},o["delete"]=function(e){$("#deleteError").hide(),o.layout=e,$("#deleteModal").modal()},o.deleteConfirmed=function(){t.remove(o.layout.layoutId).then(function(){$("#deleteModal").modal("hide"),i()},function(){$("#deleteError").show()})},o.save=function(){var e={LayoutId:o.layout.layoutId,Name:o.layout.name,Body:o.editor.getValue(),SiteId:o.site.siteId};t.update(e).then(function(){$("#editModal").modal("hide"),i()},function(){$("#saveError").show()})}}angular.module("app").controller("LayoutController",e),e.$inject=["$location","LayoutFactory","SiteFactory"]}(),function(){"use strict";function e(e,t){function n(){t.getUser().success(function(e){i.menuItems.push({isHeader:!0,name:"HAUPTMENÃœ"}),e.type<=1&&i.menuItems.push({link:"/layouts",isHeader:!1,icon:"fa-anchor",name:"Layouts"}),e.type<=2&&i.menuItems.push({link:"/assets",isHeader:!1,icon:"fa-file",name:"Assets"}),e.type<=1&&(i.menuItems.push({link:"/content",isHeader:!1,icon:"fa-clipboard",name:"Content"}),i.menuItems.push({link:"/pagelayouts",isHeader:!1,icon:"fa-book",name:"Seitenlayouts"})),e.type<=2&&i.menuItems.push({link:"/pages",isHeader:!1,icon:"fa-file",name:"Seiten"}),0==e.type&&(i.menuItems.push({isHeader:!0,name:"ADMINISTRATION"}),i.menuItems.push({link:"/sites",isHeader:!1,icon:"fa-home",name:"Webauftritte"}),i.menuItems.push({link:"/users",isHeader:!1,icon:"fa-users",name:"Nutzerverwaltung"}))})}var i=this;i.title="MenuController",i.menuItems=[],n()}angular.module("app").controller("MenuController",e),e.$inject=["$location","UserFactory"]}(),function(){"use strict";function e(e,t,n,i){function o(){n.getData().success(function(e){a.sites=e,a.site=n.getSelectedSite(e),t.getBySiteId(a.site.siteId).success(function(e){a.pages=e}),i.getBySiteId(a.site.siteId).success(function(e){a.pageLayouts=e})})}var a=this;a.title="PageController",a.modalHeadingNew="Neue Seite anlegen",a.modalHeadingEdit="Seite bearbeiten",a.modalHeading=a.modalHeadingEdit,a.pages=[],a.page={},a.pageversions=[],a.pageversion={},a.pageLayouts=[],a.sites=[],a.site={},o(),a.siteChanged=function(){n.setSelectedSite(a.site),t.getBySiteId(a.site.siteId).success(function(e){a.pages=e}),i.getBySiteId(a.site.siteId).success(function(e){a.pageLayouts=e})},a.create=function(){$("#saveError").hide(),a.modalHeading=a.modalHeadingNew,a.page={},a.page.name="",a.page.urls=[{url:"",pageUrlId:-1}],$("#editModal").modal()},a.edit=function(e){t.getData(e.pageId).success(function(e){$("#saveError").hide(),a.modalHeading=a.modalHeadingEdit,a.page=e,$("#editModal").modal()})},a.editContent=function(e){$("#saveContentError").hide(),t.getVersions(e.pageId).success(function(t){t.length>0?a.pageversion=t[0]:a.pageversion={pageId:e.pageId},$("#editContentModal").modal()})},a.showVersions=function(e){$("#publishError").hide(),a.page=e,t.getVersions(e.pageId).success(function(e){a.pageversions=e,$("#publishModal").modal()})},a.newVersion=function(){t.createNewVersion(a.page.pageId).success(function(){t.getVersions(a.page.pageId).success(function(e){a.pageversions=e})})},a.publish=function(e){t.publish(e).then(function(){t.getVersions(a.page.pageId).success(function(e){a.pageversions=e})},function(){$("#publishError").show()})},a.addUrl=function(){a.page.urls.push({url:"",pageUrlId:-1})},a.removeUrl=function(e){var t=a.page.urls.indexOf(e);a.page.urls.splice(t,1)},a["delete"]=function(e){$("#deleteError").hide(),a.page=e,$("#deleteModal").modal()},a.deleteConfirmed=function(){t.remove(a.page.pageId).then(function(){$("#deleteModal").modal("hide"),o()},function(){$("#deleteError").show()})},a.save=function(){var e={PageId:a.page.pageId,Name:a.page.name,PageLayoutId:a.page.pageLayoutId,Urls:a.page.urls};t.update(e).then(function(){$("#editModal").modal("hide"),o()},function(){$("#saveError").show()})},a.saveVersion=function(){var e={PageId:a.pageversion.pageId,Title:a.pageversion.title,MetaDescription:a.pageversion.metaDescription};t.updateVersion(e).then(function(){$("#editContentModal").modal("hide"),o()},function(){$("#saveContentError").show()})}}angular.module("app").controller("PageController",e),e.$inject=["$location","PageFactory","SiteFactory","PageLayoutFactory"]}(),function(){"use strict";function e(e,t,n,i){function o(){i.getData().success(function(e){a.sites=e,a.site=i.getSelectedSite(e),n.getBySiteId(a.site.siteId).success(function(e){a.pagelayouts=e}),t.getBySiteId(a.site.siteId).success(function(e){a.layouts=e})})}var a=this;a.title="PageLayoutController",a.modalHeadingNew="Neues Seitenlayout anlegen",a.modalHeadingEdit="Seitenlayout bearbeiten",a.modalHeading=a.modalHeadingEdit,a.pagelayouts=[],a.pagelayout={},a.layouts=[],a.sites=[],a.site={},o();var r={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]};a.editor=CodeMirror.fromTextArea(document.getElementById("htmlEditorPageLayout"),{mode:r,selectionPointer:!0}),a.siteChanged=function(){i.setSelectedSite(a.site),n.getBySiteId(a.site.siteId).success(function(e){a.pagelayouts=e}),t.getBySiteId(a.site.siteId).success(function(e){a.layouts=e})},a.create=function(){$("#saveError").hide(),a.modalHeading=a.modalHeadingNew,a.pagelayout={},a.pagelayout.name="",a.pagelayout.body="",a.editor.setValue(""),setTimeout(function(){a.editor.refresh()},200),$("#editModal").modal()},a.edit=function(e){n.getData(e.pageLayoutId).success(function(e){a.pagelayout=e,$("#saveError").hide(),a.modalHeading=a.modalHeadingEdit,a.editor.setValue(a.pagelayout.body),setTimeout(function(){a.editor.refresh()},200),$("#editModal").modal()})},a["delete"]=function(e){$("#deleteError").hide(),a.pagelayout=e,$("#deleteModal").modal()},a.deleteConfirmed=function(){n.remove(a.pagelayout.pageLayoutId).then(function(){$("#deleteModal").modal("hide"),o()},function(){$("#deleteError").show()})},a.save=function(){var e={PageLayoutId:a.pagelayout.pageLayoutId,LayoutId:a.pagelayout.layoutId,Name:a.pagelayout.name,Body:a.editor.getValue()};n.update(e).then(function(){$("#editModal").modal("hide"),o()},function(){$("#saveError").show()})}}angular.module("app").controller("PageLayoutController",e),e.$inject=["$location","LayoutFactory","PageLayoutFactory","SiteFactory"]}(),function(){"use strict";function e(e,t){function n(){t.getData().success(function(e){i.sites=e})}var i=this;i.title="SiteController",i.modalHeadingNew="Neuen Auftritt anlegen",i.modalHeadingEdit="Auftritt bearbeiten",i.modalHeading=i.modalHeadingEdit,i.sites=[],i.site={},n(),i.newSite=function(){$("#saveError").hide(),i.modalHeading=i.modalHeadingNew,i.site={},i.site.name="",i.site.bindings=[{value:""}],$("#editSiteModal").modal()},i.editSite=function(e){$("#saveError").hide(),i.modalHeading=i.modalHeadingEdit,i.site={},i.site.siteId=e.siteId,i.site.name=e.name,i.site.bindings=[],angular.forEach(e.bindings,function(e){i.site.bindings.push({value:e})}),$("#editSiteModal").modal()},i.deleteSite=function(e){$("#deleteError").hide(),i.site=e,$("#deleteSiteModal").modal()},i.deleteConfirmed=function(){t.remove(i.site.siteId).then(function(){$("#deleteSiteModal").modal("hide"),n()},function(){$("#deleteError").show()})},i.addBinding=function(){i.site.bindings.push({value:""})},i.removeBinding=function(e){var t=i.site.bindings.indexOf(e);i.site.bindings.splice(t,1)},i.save=function(){var e={SiteId:i.site.siteId,Name:i.site.name,Bindings:[]};angular.forEach(i.site.bindings,function(t){e.Bindings.push(t.value)}),t.update(e).then(function(){$("#editSiteModal").modal("hide"),n()},function(){$("#saveError").show()})}}angular.module("app").controller("SiteController",e),e.$inject=["$location","SiteFactory"]}(),function(){"use strict";function e(e,t,n){function i(){n.getData().success(function(e){o.sites=e}),t.getAll().success(function(e){o.users=e})}var o=this;o.title="UserController",o.modalHeadingNew="Neuen Nutzer anlegen",o.modalHeadingEdit="Nutzer bearbeiten",o.modalHeading=o.modalHeadingEdit,o.showPasswordBox=!1,o.users=[],o.user={},o.userTypes=[{id:0,name:"Administrator"},{id:1,name:"Designer"},{id:2,name:"Editor"}],o.sites=[],i(),o.displayUserType=function(e){for(var t=0;t<o.userTypes.length;++t){var n=o.userTypes[t];if(n.id==e)return n.name}return"Unbekannt"},o.newUser=function(){$("#saveError").hide(),o.modalHeading=o.modalHeadingNew,o.showPasswordBox=!0,o.user={},o.user.userName="",o.user.type="2",$("#editModal").modal()},o.editUser=function(e){$("#saveError").hide(),o.modalHeading=o.modalHeadingEdit,o.showPasswordBox=!1,o.user={},o.user.userId=e.userId,o.user.userName=e.userName,o.user.type=e.type.toString(),o.user.siteId=e.siteId,$("#editModal").modal()},o.save=function(){if(null==o.user.userId){var e={UserName:o.user.userName,Password:o.user.password,Type:o.user.type,SiteId:o.user.siteId};t.create(e).then(function(){$("#editModal").modal("hide"),i()},function(){$("#saveError").show()})}else{var e={UserId:o.user.userId,UserName:o.user.userName,Type:o.user.type,SiteId:o.user.siteId};t.update(e).then(function(){$("#editModal").modal("hide"),i()},function(){$("#saveError").show()})}},o.deleteUser=function(e){$("#deleteError").hide(),o.user=e,$("#deleteModal").modal()},o.deleteConfirmed=function(){t.remove(o.user.userId).then(function(){$("#deleteModal").modal("hide"),i()},function(){$("#deleteError").show()})}}angular.module("app").controller("UserController",e),e.$inject=["$location","UserFactory","SiteFactory"]}(),function(){"use strict";function e(e){function t(){}var n=this;n.title="WelcomeController",t()}angular.module("app").controller("WelcomeController",e),e.$inject=["$location"]}(),function(){"use strict";function e(e,t){function n(e,n,i){var o="active",a=i.activeLink;e.location=t,e.$watch("location.path()",function(e){a===e?n.addClass(o):n.removeClass(o)})}var i={link:n,restrict:"A"};return i}angular.module("app").directive("activeLink",e),e.$inject=["$window","$location"]}(),function(){"use strict";function e(e,t){function n(e,n,i){var o=t(i.fileModel),a=o.assign;n.bind("change",function(){e.$apply(function(){a(e,n[0].files[0])})})}var i={link:n,restrict:"A"};return i}angular.module("app").directive("fileModel",e),e.$inject=["$window","$parse"]}(),function(){"use strict";function e(e,t,n){function i(t,i,o){t.isLoading=function(){return e.pendingRequests.length>0},t.timer=null,t.$watch(t.isLoading,function(e){e?t.timer=n(function(){i.fadeIn(100),t.timer=null},300):(null!=t.timer&&n.cancel(t.timer),i.fadeOut(100))})}var o={link:i,restrict:"A"};return o}angular.module("app").directive("loading",e),e.$inject=["$http","$window","$timeout"]}(),function(){"use strict";function e(e,t){function n(t){return e.get("/api/asset?siteId="+t)}function i(e){var t=new FormData;return angular.forEach(e,function(e,n){t.append(n,e)}),t}function o(n){var o=t.defer();return e({url:"/AssetUpload/SaveAsset",method:"POST",data:i(n),transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){o.resolve(e)}).error(function(e,t){o.reject(t)}),o.promise}function a(t,n){return e["delete"]("/api/asset?name="+n+"&siteId="+t)}var r={getData:n,upload:o,remove:a};return r}angular.module("app").factory("AssetFactory",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e){function t(t){return e.get("/api/content?siteId="+t)}function n(t){return e.get("/api/content/"+t)}function i(t){return e.post("/api/content",t)}function o(t){return e["delete"]("/api/content/"+t)}var a={getBySiteId:t,getData:n,update:i,remove:o};return a}angular.module("app").factory("ContentFactory",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){return e.get("/api/layout?siteId="+t)}function n(t){return e.get("/api/layout/"+t)}function i(t){return e.post("/api/layout",t)}function o(t){return e["delete"]("/api/layout/"+t)}var a={getBySiteId:t,getData:n,update:i,remove:o};return a}angular.module("app").factory("LayoutFactory",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){return e.get("/api/page?siteId="+t)}function n(t){return e.get("/api/page/"+t)}function i(t){return e.get("/api/pageversion?pageId="+t)}function o(t){return e.post("/api/page",t)}function a(t){return e.post("/api/pageversion",t)}function r(t){return e.post("/api/pageversion/publish?versionId="+t)}function s(t){return e.post("/api/pageversion/newversion?pageId="+t)}function d(t){return e["delete"]("/api/page/"+t)}var u={getBySiteId:t,getData:n,getVersions:i,update:o,publish:r,createNewVersion:s,updateVersion:a,remove:d};return u}angular.module("app").factory("PageFactory",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){return e.get("/api/pagelayout?siteId="+t)}function n(t){return e.get("/api/pagelayout/"+t)}function i(t){return e.post("/api/pagelayout",t)}function o(t){return e["delete"]("/api/pagelayout/"+t)}var a={getBySiteId:t,getData:n,update:i,remove:o};return a}angular.module("app").factory("PageLayoutFactory",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){function n(){return e.get("/api/site")}function i(e){if("undefined"==typeof t.selectedSiteId&&(t.selectedSiteId=adminAppGlobalSettings.defaultSiteId,""==t.selectedSiteId))return t.selectedSiteId=e[0].siteId,e[0];for(var n=0;n<e.length;++n){var i=e[n];if(t.selectedSiteId==i.siteId)return i}}function o(e){t.selectedSiteId=e.siteId}function a(t){return e.post("/api/site",t)}function r(t){return e["delete"]("/api/site/"+t)}var s={getData:n,getSelectedSite:i,setSelectedSite:o,update:a,remove:r};return s}angular.module("app").factory("SiteFactory",e),e.$inject=["$http","$rootScope"]}(),function(){"use strict";function e(e,t){function n(){return"undefined"==typeof t.appUser?e.get("/api/user").success(function(e){return t.appUser=e,e}):t.appUser}function i(){return e.get("/api/user/all")}function o(t){return e.post("/api/user/create",t)}function a(t){return e.post("/api/user",t)}function r(t){return e["delete"]("/api/user/"+t)}var s={getUser:n,getAll:i,create:o,update:a,remove:r};return s}angular.module("app").factory("UserFactory",e),e.$inject=["$http","$rootScope"]}();